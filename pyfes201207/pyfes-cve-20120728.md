
# Do not invent your own RNG (CVE-2012-2808)<br>28-JUL-2012<br>Kenji Rikitake<br>@kenji_rikitake

---

## DNS and secure randomness

* Query ID (16bit)
* Source port number (~16bit)
* ~32bit randomness needed

---

## Android's bad code

    !c
    /*
     * source: (single URL)
     * http://blog.watchfire.com/wfblog/2012/07/
     * android-dns-poisoning-randomness-gone-bad-
     * cve-2012-2808.html
     */

    u_int res_randomid(void) {
      struct timeval now;
    
      gettimeofday(&now, NULL);
      return (0xffff &
        (now.tv_sec ^ now.tv_usec ^ getpid()));
    } 

---

## Why this is **BAD**?

* Three parameters: time (sec/microsec), pid
* These parameters won't change much between two **consecutive** calls
* Very small randomness (~21 bits) = predictable = vulnerability

---

# An old lesson: don't invent your own RNG

---

## So how Android fixed this?

* 4.1.1 and later use `/dev/urandom` (much more secure RNG)
* 4.0.4 and below are vulnerable
* Will the old ones be ever fixed??

---

## The Right Ways on Python

* Secure RNG: `os.urandom(n)` (= `/dev/urandom` or `CryptGenRandom` on Windows)
* For non-secure but safe RNG: `random` module (uses Mersenne Twister) (very good RNG)
* For unique IDs: use `uuid`

---

## References

* [Full Disclosure: Android DNS poisoning: Randomness gone bad (CVE-2012-2808)](http://seclists.org/fulldisclosure/2012/Jul/334)
* [IBM Application Security Insider: Android DNS Poisoning: Randomness gone bad (CVE-2012-2808)](http://blog.watchfire.com/wfblog/2012/07/android-dns-poisoning-randomness-gone-bad-cve-2012-2808.html)

---

# Questions?

